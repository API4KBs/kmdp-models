package {{packageName}};

import java.net.URI;
import java.util.Arrays;
import java.util.List;
import java.util.Optional;
import java.util.UUID;

import edu.mayo.kmdp.id.Term;
import edu.mayo.kmdp.id.Identifier;
import edu.mayo.kmdp.id.helper.DatatypeHelper;
import edu.mayo.kmdp.terms.ConceptScheme;
import edu.mayo.kmdp.terms.Taxonomic;
import edu.mayo.kmdp.terms.impl.model.DefaultConceptScheme;

import org.omg.spec.api4kp._1_0.identifiers.URIIdentifier;
import org.omg.spec.api4kp._1_0.identifiers.NamespaceIdentifier;

import {{implClassName}};


{{#jaxb}}
@javax.xml.bind.annotation.XmlType(name = "{{typeName}}")
@javax.xml.bind.annotation.XmlEnum
@javax.xml.bind.annotation.adapters.XmlJavaTypeAdapter( {{typeName}}.Adapter.class )
{{/jaxb}}
{{#json}}
@com.fasterxml.jackson.databind.annotation.JsonSerialize( as = org.omg.spec.api4kp._1_0.identifiers.ConceptIdentifier.class, using = edu.mayo.kmdp.terms.TermsJsonAdapter.Serializer.class )
@com.fasterxml.jackson.databind.annotation.JsonDeserialize( using = {{typeName}}.JsonAdapter.class )
{{/json}}

public enum {{typeName}} implements Term, Taxonomic<{{typeName}}> {

   {{#concepts}}

    /* {{comment}} */
    {{#jaxb}}@javax.xml.bind.annotation.XmlEnumValue("{{tag}}"){{/jaxb}}
    {{#jsonld}}@de.escalon.hypermedia.hydra.mapping.Expose( "{{ref}}" ){{/jsonld}}
    {{termConceptName}}( "{{conceptId}}", "{{conceptUUID}}", "{{tag}}", java.util.Arrays.asList( {{#notations}}"{{.}}"{{^-last}}, {{/-last}}{{/notations}} ), "{{label}}", "{{ref}}",
        new Term[] { {{#ancestors}} {{#overridePk}}{{termConceptPackage}}{{/overridePk}}.{{termConceptScheme}}.{{termConceptName}}, {{/ancestors}} },
        new Term[] { {{#closure}} {{#overridePk}}{{termConceptPackage}}{{/overridePk}}.{{termConceptScheme}}.{{termConceptName}}, {{/closure}} } ) {{^-last}}, {{/-last}}
   {{/concepts}};



  public static final String schemeName = "{{conceptScheme.label}}";
  public static final String schemeID = "{{conceptSchemeID}}";

  public static final URIIdentifier schemeURI = new URIIdentifier()
                                                    .withUri( URI.create( "{{conceptScheme.id}}" ) )
                                                    .withVersionId( URI.create( "{{conceptScheme.versionId}}" ) );

	public static final NamespaceIdentifier __SCHEME = new NamespaceIdentifier().withId( schemeURI.getUri() )
    	                                                                      .withLabel( schemeName )
    	                                                                      .withTag( schemeID )
    	                                                                      .withVersion( DatatypeHelper.versionOf( schemeURI.getVersionId(), schemeURI.getUri() ) );



  private URI	ref;
  private UUID conceptUUID;
	private String displayName;
	private String tag;
	private List<String> tags;
	private URI conceptId;

	private Term[] ancestors;
	private Term[] ancestorsClosure;

	{{typeName}}( String conceptId, String conceptUUID, String code, List<String> additionalCodes, String displayName, String referent, Term[] ancestors, Term[] closure ) {
		this.ref = URI.create( referent );
		this.tag = code;
		this.tags = java.util.Collections.unmodifiableList(additionalCodes);
		this.displayName = displayName;
		this.ancestors = ancestors;
		this.ancestorsClosure = closure;
		this.conceptId = URI.create(conceptId);
		this.conceptUUID = UUID.fromString(conceptUUID);
	}


	@Override
	public String getLabel() {
		return displayName;
	}

	@Override
	public String getTag() {
		return tag;
	}

	public List<String> getTags() {
	  return tags;
	}

	public UUID getConceptUUID() {
	  return conceptUUID;
	}

	@Override
	public URI getRef() {
		return ref;
	}

	@Override
	public URI getConceptId() {
	  return conceptId;
	}

	@Override
	public NamespaceIdentifier getNamespace() {
	  return __SCHEME;
	}

  public org.omg.spec.api4kp._1_0.identifiers.ConceptIdentifier asConcept() {
    return {{packageName}}.{{typeName}}.Adapter.instance.marshal( this );
  }

  public org.omg.spec.api4kp._1_0.identifiers.QualifiedIdentifier asQualified() {
    return edu.mayo.kmdp.id.helper.DatatypeHelper.toQualifiedIdentifier( this.ref );
  }

	@Override
	public Term[] getClosure() {
		return ancestorsClosure;
	}

	public Term[] getAncestors() {
		return ancestors;
	}


  public static Optional<{{typeName}}> resolve(final Term trm) {
    return Arrays.stream({{typeName}}.values())
        .filter((x) -> trm.getRef().equals(x.getRef()))
        .findAny();
  }

  public static Optional<{{typeName}}> resolve(final String tag) {
    return Arrays.stream({{typeName}}.values())
        .filter((x) -> x.getTag().equals(tag))
        .findAny();
  }

  public static Optional<{{typeName}}> resolveTag(final String tag) {
    return Arrays.stream({{typeName}}.values())
        .filter((x) -> x.getTags().contains(tag))
        .findAny();
  }

  public static Optional<{{typeName}}> resolveUUID(final UUID conceptId) {
    return Arrays.stream({{typeName}}.values())
        .filter((x) -> x.getConceptUUID().equals(conceptId))
        .findAny();
  }

  public static Optional<{{typeName}}> resolveId(final String conceptId) {
    return Arrays.stream({{typeName}}.values())
        .filter((x) -> x.getConceptId().toString().equals(conceptId) || x.getConceptUUID().toString().equals(conceptId))
        .findAny();
  }

  public static Optional<{{typeName}}> resolveRef(final String refUri) {
    return Arrays.stream({{typeName}}.values())
        .filter((x) -> x.getRef().toString().equals(refUri))
        .findAny();
  }

  public static class Adapter extends {{baseXmlAdapter}} {
    public static final {{baseXmlAdapter}} instance = new Adapter();
    protected Term[] getValues() { return values(); }
	}

  public static class JsonAdapter extends {{baseJsonAdapter}} {
    public static final {{baseJsonAdapter}} instance = new JsonAdapter();
    protected Term[] getValues() { return values(); }
  }
}


